<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>files</title>
</head>
<body>
    <div class="container">
        <input type="file" id="avatar" multiple>
        <button id="btn">submit</button>
    </div>

    <script type="text/javascript">
        const btn = document.getElementById('btn')
        const reader = new FileReader();

        // input.addEventListener('change', (event) => {
        //   const files = event.target.files;
        //   console.log('files', files);
        // });
        // const upload = (file) => {
        //     fetch('/getfiles', { // Your POST endpoint
        //         method: 'POST',
        //         headers: {
        //            "Content-Type": "multipart/form-data"
        //         },
        //         body: file // This is your file object
        //     }).then(
        //       response => response.json() // if the response is a JSON object
        //     ).then(
        //       success => console.log(success) // Handle the success response object
        //     ).catch(
        //       error => console.log(error) // Handle the error response object
        //     );
        // };

        // // Event handler executed when a file is selected
        // const onSelectFile = () => upload(fileUploader.files[0]);

        // // Add a listener on your input
        // // It will be triggered when a file will be selected
        // btn.addEventListener('change', onSelectFile, false);
        // delete options.headers['Content-Type'];
        // var input = document.querySelector('input[type="file"]')
        // var data = new FormData()
        // data.append(input.files[0], file)
        // data.append('user', 'hubot')
        // function ap(){
        //     fetch('/getfiles', {
        //         method: 'POST',
        //         headers: {
        //                    "Content-Type": "multipart/form-data"
        //                 },
        //         body: data
        //         })
        //         .then((response) => response.json())
        //         .then((result) => {
        //             console.log('Success:', result);
        //         })
        //         .catch((error) => {
        //             console.error('Error:', error);
        //         });
        // }
        // const res = await axios.post('/upload', formData, {
        //     headers: {
        //         'Content-Type': 'multipart/form-data'
        //     }
        // });

        const input = document.getElementById('avatar')
        input.addEventListener('change', () => {
            uploadFile(input.files[0])
        })

        const uploadFile = file => {
            // add the file to the FormData object
            const fd = new FormData()
            fd.append('avatar', file)

            // send `POST` request
            fetch('/upload-avatar', {
                method: 'POST',
                body: fd
            })              
            .then(res => res.json())
            .then(json => console.log(json))
             .catch(err => console.error(err))
            }
    </script>
</body>
</html>